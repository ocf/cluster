apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: sopel
spec:
  replicas: 1
  selector:
    matchLabels:
      k8s.ocf.io/app: ergo
      k8s.ocf.io/component: sopel
  serviceName: sopel
  template:
    metadata:
      labels:
        k8s.ocf.io/app: ergo
        k8s.ocf.io/component: sopel
    spec:
      containers:
      - image: ghcr.io/ocf/ergo-sopel:508dd900ec2db1a4bb5713460522996115d9bff3
        name: sopel
        volumeMounts:
        - mountPath: /home/sopel/.sopel/default.cfg
          name: sopel-config
          subPath: default.cfg
        - mountPath: /home/sopel/.sopel/
          name: sopel-data
        - mountPath: /home/sopel/.sopel/plugins/
          name: sopel-plugins
      securityContext:
        fsGroup: 1000
        runAsGroup: 1000
        runAsUser: 1000
      volumes:
      - name: sopel-config
        secret:
          secretName: sopel-config
      - configMap:
          name: sopel-plugins
        name: sopel-plugins
  volumeClaimTemplates:
  - metadata:
      name: sopel-data
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 32Gi
