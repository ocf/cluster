apiVersion: batch/v1
kind: CronJob
metadata:
  labels:
    app.kubernetes.io/name: hubble-generate-certs
    app.kubernetes.io/part-of: cilium
    k8s-app: hubble-generate-certs
  name: hubble-generate-certs
  namespace: cilium
spec:
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            k8s-app: hubble-generate-certs
        spec:
          affinity: null
          automountServiceAccountToken: true
          containers:
          - args:
            - --ca-generate=true
            - --ca-reuse-secret
            - --ca-secret-namespace=cilium
            - --ca-secret-name=cilium-ca
            - --ca-common-name=Cilium CA
            command:
            - /usr/bin/cilium-certgen
            env:
            - name: CILIUM_CERTGEN_CONFIG
              value: "certs:\n- name: hubble-server-certs\n  namespace: cilium\n \
                \ commonName: \"*.default.hubble-grpc.cilium.io\"\n  hosts:\n  - \"\
                *.default.hubble-grpc.cilium.io\"\n  usage:\n  - signing\n  - key\
                \ encipherment\n  - server auth\n  - client auth\n  validity: 8760h\n\
                - name: hubble-relay-client-certs\n  namespace: cilium\n  commonName:\
                \ \"*.hubble-relay.cilium.io\"\n  hosts:\n  - \"*.hubble-relay.cilium.io\"\
                \n  usage:\n  - signing\n  - key encipherment\n  - client auth\n \
                \ validity: 8760h\n"
            image: quay.io/cilium/certgen:v0.2.4@sha256:de7b97b1d19a34b674d0c4bc1da4db999f04ae355923a9a994ac3a81e1a1b5ff
            imagePullPolicy: IfNotPresent
            name: certgen
            securityContext:
              allowPrivilegeEscalation: false
              capabilities:
                drop:
                - ALL
          hostNetwork: false
          restartPolicy: OnFailure
          securityContext:
            seccompProfile:
              type: RuntimeDefault
          serviceAccount: hubble-generate-certs
          serviceAccountName: hubble-generate-certs
      ttlSecondsAfterFinished: 1800
  schedule: 0 0 1 */4 *
