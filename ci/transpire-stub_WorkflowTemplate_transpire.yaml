apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: transpire-stub
  namespace: transpire
spec:
  arguments:
    parameters:
    - name: git
      valueFrom:
        event: payload.repository.url
    - name: branch
      valueFrom:
        configMapKeyRef:
          key: payload.ref
    - name: dir
      value: /
  entrypoint: transpire-stub
  templates:
  - container:
      command:
      - python
      - -m
      - transpire.internal.stub
      env:
      - name: GIT_URL
        value: '{{workflow.parameters.git}}'
      - name: GIT_BRANCH
        value: '{{workflow.parameters.branch}}'
      - name: DIR
        value: '{{workflow.parameters.dir}}'
      image: ghcr.io/ocf/transpire
    name: stub
  - dag:
      tasks:
      - name: stub
        template: stub
    name: transpire-stub
